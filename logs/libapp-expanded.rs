fname: "lv_font_get_glyph_bitmap", namespace: "lv"
fname: "lv_font_get_glyph_dsc", namespace: "lv"
fname: "lv_font_get_glyph_width", namespace: "lv"
fname: "lv_font_get_line_height", namespace: "lv"
fname: "lv_color_to1", namespace: "lv"
fname: "lv_color_to8", namespace: "lv"
fname: "lv_color_to16", namespace: "lv"
fname: "lv_color_to32", namespace: "lv"
fname: "lv_color_mix", namespace: "lv"
fname: "lv_color_brightness", namespace: "lv"
fname: "lv_color_make", namespace: "lv"
fname: "lv_color_hex", namespace: "lv"
fname: "lv_color_hex3", namespace: "lv"
fname: "lv_color_hsv_to_rgb", namespace: "lv"
fname: "lv_color_rgb_to_hsv", namespace: "lv"
fname: "lv_color_to_hsv", namespace: "lv"
fname: "lv_area_set", namespace: "lv"
fname: "lv_area_copy", namespace: "lv"
fname: "lv_area_get_width", namespace: "lv"
fname: "lv_area_get_height", namespace: "lv"
fname: "lv_area_set_width", namespace: "lv"
fname: "lv_area_set_height", namespace: "lv"
fname: "lv_area_set_pos", namespace: "lv"
fname: "lv_area_get_size", namespace: "lv"
fname: "lv_area_intersect", namespace: "lv"
fname: "lv_area_join", namespace: "lv"
fname: "lv_area_is_point_on", namespace: "lv"
fname: "lv_area_is_on", namespace: "lv"
fname: "lv_area_is_in", namespace: "lv"
fname: "lv_area_increment", namespace: "lv"
fname: "lv_anim_core_init", namespace: "lv"
fname: "lv_anim_init", namespace: "lv"
fname: "lv_anim_set_exec_cb", namespace: "lv"
fname: "lv_anim_set_time", namespace: "lv"
fname: "lv_anim_set_values", namespace: "lv"
fname: "lv_anim_set_custom_exec_cb", namespace: "lv"
fname: "lv_anim_set_path_cb", namespace: "lv"
fname: "lv_anim_set_ready_cb", namespace: "lv"
fname: "lv_anim_set_playback", namespace: "lv"
fname: "lv_anim_clear_playback", namespace: "lv"
fname: "lv_anim_set_repeat", namespace: "lv"
fname: "lv_anim_clear_repeat", namespace: "lv"
fname: "lv_anim_create", namespace: "lv"
fname: "lv_anim_del", namespace: "lv"
fname: "lv_anim_custom_del", namespace: "lv"
fname: "lv_anim_count_running", namespace: "lv"
fname: "lv_anim_speed_to_time", namespace: "lv"
fname: "lv_anim_path_linear", namespace: "lv"
fname: "lv_anim_path_ease_in", namespace: "lv"
fname: "lv_anim_path_ease_out", namespace: "lv"
fname: "lv_anim_path_ease_in_out", namespace: "lv"
fname: "lv_anim_path_overshoot", namespace: "lv"
fname: "lv_anim_path_bounce", namespace: "lv"
fname: "lv_anim_path_step", namespace: "lv"
fname: "lv_style_init", namespace: "lv"
fname: "lv_style_copy", namespace: "lv"
fname: "lv_style_mix", namespace: "lv"
fname: "lv_style_anim_init", namespace: "lv"
fname: "lv_style_anim_set_styles", namespace: "lv"
fname: "lv_style_anim_set_time", namespace: "lv"
fname: "lv_style_anim_set_ready_cb", namespace: "lv"
fname: "lv_style_anim_set_playback", namespace: "lv"
fname: "lv_style_anim_clear_playback", namespace: "lv"
fname: "lv_style_anim_set_repeat", namespace: "lv"
fname: "lv_style_anim_clear_repeat", namespace: "lv"
fname: "lv_style_anim_create", namespace: "lv"
fname: "lv_mem_init", namespace: "lv"
fname: "lv_mem_alloc", namespace: "lv"
fname: "lv_mem_free", namespace: "lv"
fname: "lv_mem_realloc", namespace: "lv"
fname: "lv_mem_defrag", namespace: "lv"
fname: "lv_mem_monitor", namespace: "lv"
fname: "lv_mem_get_size", namespace: "lv"
fname: "lv_ll_init", namespace: "lv"
fname: "lv_ll_ins_head", namespace: "lv"
fname: "lv_ll_ins_prev", namespace: "lv"
fname: "lv_ll_ins_tail", namespace: "lv"
fname: "lv_ll_rem", namespace: "lv"
fname: "lv_ll_clear", namespace: "lv"
fname: "lv_ll_chg_list", namespace: "lv"
fname: "lv_ll_get_head", namespace: "lv"
fname: "lv_ll_get_tail", namespace: "lv"
fname: "lv_ll_get_next", namespace: "lv"
fname: "lv_ll_get_prev", namespace: "lv"
fname: "lv_ll_get_len", namespace: "lv"
fname: "lv_ll_move_before", namespace: "lv"
fname: "lv_ll_is_empty", namespace: "lv"
fname: "lv_task_core_init", namespace: "lv"
fname: "lv_task_handler", namespace: "lv"
fname: "lv_task_create_basic", namespace: "lv"
fname: "lv_task_create", namespace: "lv"
fname: "lv_task_del", namespace: "lv"
fname: "lv_task_set_cb", namespace: "lv"
fname: "lv_task_set_prio", namespace: "lv"
fname: "lv_task_set_period", namespace: "lv"
fname: "lv_task_ready", namespace: "lv"
fname: "lv_task_once", namespace: "lv"
fname: "lv_task_reset", namespace: "lv"
fname: "lv_task_enable", namespace: "lv"
fname: "lv_task_get_idle", namespace: "lv"
fname: "lv_disp_drv_init", namespace: "lv"
fname: "lv_disp_buf_init", namespace: "lv"
fname: "lv_disp_drv_register", namespace: "lv"
fname: "lv_disp_drv_update", namespace: "lv"
fname: "lv_disp_remove", namespace: "lv"
fname: "lv_disp_set_default", namespace: "lv"
fname: "lv_disp_get_default", namespace: "lv"
fname: "lv_disp_get_hor_res", namespace: "lv"
fname: "lv_disp_get_ver_res", namespace: "lv"
fname: "lv_disp_get_antialiasing", namespace: "lv"
fname: "lv_disp_set_direction", namespace: "lv"
fname: "lv_disp_flush_ready", namespace: "lv"
fname: "lv_disp_get_next", namespace: "lv"
fname: "lv_disp_get_buf", namespace: "lv"
fname: "lv_disp_get_inv_buf_size", namespace: "lv"
fname: "lv_disp_pop_from_inv_buf", namespace: "lv"
fname: "lv_disp_is_double_buf", namespace: "lv"
fname: "lv_disp_is_true_double_buf", namespace: "lv"
fname: "lv_indev_drv_init", namespace: "lv"
fname: "lv_indev_drv_register", namespace: "lv"
fname: "lv_indev_drv_update", namespace: "lv"
fname: "lv_indev_get_next", namespace: "lv"
fname: "lv_indev_read", namespace: "lv"
fname: "lv_tick_inc", namespace: "lv"
fname: "lv_tick_get", namespace: "lv"
fname: "lv_tick_elaps", namespace: "lv"
fname: "lv_init", namespace: ""
fname: "lv_obj_create", namespace: "lv_obj"
fname: "lv_obj_del", namespace: "lv_obj"
fname: "lv_obj_del_async", namespace: "lv_obj"
fname: "lv_obj_clean", namespace: "lv_obj"
fname: "lv_obj_invalidate", namespace: "lv_obj"
fname: "lv_obj_set_parent", namespace: "lv_obj"
fname: "lv_obj_move_foreground", namespace: "lv_obj"
fname: "lv_obj_move_background", namespace: "lv_obj"
fname: "lv_obj_set_pos", namespace: "lv_obj"
fname: "lv_obj_set_x", namespace: "lv_obj"
fname: "lv_obj_set_y", namespace: "lv_obj"
fname: "lv_obj_set_size", namespace: "lv_obj"
fname: "lv_obj_set_width", namespace: "lv_obj"
fname: "lv_obj_set_height", namespace: "lv_obj"
fname: "lv_obj_align", namespace: "lv_obj"
fname: "lv_obj_align_origo", namespace: "lv_obj"
fname: "lv_obj_realign", namespace: "lv_obj"
fname: "lv_obj_set_auto_realign", namespace: "lv_obj"
fname: "lv_obj_set_ext_click_area", namespace: "lv_obj"
fname: "lv_obj_set_style", namespace: "lv_obj"
fname: "lv_obj_refresh_style", namespace: "lv_obj"
fname: "lv_obj_report_style_mod", namespace: "lv_obj"
fname: "lv_obj_set_hidden", namespace: "lv_obj"
fname: "lv_obj_set_click", namespace: "lv_obj"
fname: "lv_obj_set_top", namespace: "lv_obj"
fname: "lv_obj_set_drag", namespace: "lv_obj"
fname: "lv_obj_set_drag_dir", namespace: "lv_obj"
fname: "lv_obj_set_drag_throw", namespace: "lv_obj"
fname: "lv_obj_set_drag_parent", namespace: "lv_obj"
fname: "lv_obj_set_parent_event", namespace: "lv_obj"
fname: "lv_obj_set_base_dir", namespace: "lv_obj"
fname: "lv_obj_set_opa_scale_enable", namespace: "lv_obj"
fname: "lv_obj_set_opa_scale", namespace: "lv_obj"
fname: "lv_obj_set_protect", namespace: "lv_obj"
fname: "lv_obj_clear_protect", namespace: "lv_obj"
fname: "lv_obj_set_event_cb", namespace: "lv_obj"
fname: "lv_event_send", namespace: "lv"
fname: "lv_event_send_func", namespace: "lv"
fname: "lv_event_get_data", namespace: "lv"
fname: "lv_obj_set_signal_cb", namespace: "lv_obj"
fname: "lv_signal_send", namespace: "lv"
fname: "lv_obj_set_design_cb", namespace: "lv_obj"
fname: "lv_obj_allocate_ext_attr", namespace: "lv_obj"
fname: "lv_obj_refresh_ext_draw_pad", namespace: "lv_obj"
fname: "lv_obj_get_screen", namespace: "lv_obj"
fname: "lv_obj_get_disp", namespace: "lv_obj"
fname: "lv_obj_get_parent", namespace: "lv_obj"
fname: "lv_obj_get_child", namespace: "lv_obj"
fname: "lv_obj_get_child_back", namespace: "lv_obj"
fname: "lv_obj_count_children", namespace: "lv_obj"
fname: "lv_obj_count_children_recursive", namespace: "lv_obj"
fname: "lv_obj_get_coords", namespace: "lv_obj"
fname: "lv_obj_get_inner_coords", namespace: "lv_obj"
fname: "lv_obj_get_x", namespace: "lv_obj"
fname: "lv_obj_get_y", namespace: "lv_obj"
fname: "lv_obj_get_width", namespace: "lv_obj"
fname: "lv_obj_get_height", namespace: "lv_obj"
fname: "lv_obj_get_width_fit", namespace: "lv_obj"
fname: "lv_obj_get_height_fit", namespace: "lv_obj"
fname: "lv_obj_get_auto_realign", namespace: "lv_obj"
fname: "lv_obj_get_ext_click_pad_left", namespace: "lv_obj"
fname: "lv_obj_get_ext_click_pad_right", namespace: "lv_obj"
fname: "lv_obj_get_ext_click_pad_top", namespace: "lv_obj"
fname: "lv_obj_get_ext_click_pad_bottom", namespace: "lv_obj"
fname: "lv_obj_get_ext_draw_pad", namespace: "lv_obj"
fname: "lv_obj_get_style", namespace: "lv_obj"
fname: "lv_obj_get_hidden", namespace: "lv_obj"
fname: "lv_obj_get_click", namespace: "lv_obj"
fname: "lv_obj_get_top", namespace: "lv_obj"
fname: "lv_obj_get_drag", namespace: "lv_obj"
fname: "lv_obj_get_drag_dir", namespace: "lv_obj"
fname: "lv_obj_get_drag_throw", namespace: "lv_obj"
fname: "lv_obj_get_drag_parent", namespace: "lv_obj"
fname: "lv_obj_get_parent_event", namespace: "lv_obj"
fname: "lv_obj_get_base_dir", namespace: "lv_obj"
fname: "lv_obj_get_opa_scale_enable", namespace: "lv_obj"
fname: "lv_obj_get_opa_scale", namespace: "lv_obj"
fname: "lv_obj_get_protect", namespace: "lv_obj"
fname: "lv_obj_is_protected", namespace: "lv_obj"
fname: "lv_obj_get_signal_cb", namespace: "lv_obj"
fname: "lv_obj_get_design_cb", namespace: "lv_obj"
fname: "lv_obj_get_event_cb", namespace: "lv_obj"
fname: "lv_obj_get_ext_attr", namespace: "lv_obj"
fname: "lv_obj_get_type", namespace: "lv_obj"
fname: "lv_obj_get_user_data", namespace: "lv_obj"
fname: "lv_obj_get_user_data_ptr", namespace: "lv_obj"
fname: "lv_obj_set_user_data", namespace: "lv_obj"
fname: "lv_obj_get_group", namespace: "lv_obj"
fname: "lv_obj_is_focused", namespace: "lv_obj"
fname: "lv_obj_handle_get_type_signal", namespace: "lv_obj"
fname: "lv_label_create", namespace: "lv_label"
fname: "lv_label_set_text", namespace: "lv_label"
fname: "lv_label_set_text_fmt", namespace: "lv_label"
fname: "lv_label_set_array_text", namespace: "lv_label"
fname: "lv_label_set_static_text", namespace: "lv_label"
fname: "lv_label_set_long_mode", namespace: "lv_label"
fname: "lv_label_set_align", namespace: "lv_label"
fname: "lv_label_set_recolor", namespace: "lv_label"
fname: "lv_label_set_body_draw", namespace: "lv_label"
fname: "lv_label_set_anim_speed", namespace: "lv_label"
fname: "lv_label_set_style", namespace: "lv_label"
fname: "lv_label_set_text_sel_start", namespace: "lv_label"
fname: "lv_label_set_text_sel_end", namespace: "lv_label"
fname: "lv_label_get_text", namespace: "lv_label"
fname: "lv_label_get_long_mode", namespace: "lv_label"
fname: "lv_label_get_align", namespace: "lv_label"
fname: "lv_label_get_recolor", namespace: "lv_label"
fname: "lv_label_get_body_draw", namespace: "lv_label"
fname: "lv_label_get_anim_speed", namespace: "lv_label"
fname: "lv_label_get_letter_pos", namespace: "lv_label"
fname: "lv_label_get_letter_on", namespace: "lv_label"
fname: "lv_label_is_char_under_pos", namespace: "lv_label"
fname: "lv_label_get_style", namespace: "lv_label"
fname: "lv_label_get_text_sel_start", namespace: "lv_label"
fname: "lv_label_get_text_sel_end", namespace: "lv_label"
fname: "lv_label_ins_text", namespace: "lv_label"
fname: "lv_label_cut_text", namespace: "lv_label"
#![feature(prelude_import)]
/*
 * Licensed to the Apache Software Foundation (ASF) under one
 * or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information
 * regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the
 * "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *
 *  http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 * KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations
 * under the License.
 */
//!  Main Rust Application for PineTime with Apache Mynewt OS
#![no_std]
//  Don't link with standard Rust library, which is not compatible with embedded systems
#![feature(trace_macros)]
//  Allow macro tracing: `trace_macros!(true)`
#![feature(concat_idents)]
//  Allow `concat_idents!()` macro used in `coap!()` macro
#![feature(const_transmute)]
//  Allow `transmute` for initialising Mynewt structs
#![feature(proc_macro_hygiene)]
//  Allow Procedural Macros like `run!()`
#![feature(specialization)]
//  Allow Specialised Traits for druid UI library
#![feature(exclusive_range_pattern)]
#[prelude_import]
use core::prelude::v1::*;
#[macro_use]
extern crate core;
#[macro_use]
extern crate compiler_builtins;
//  Allow ranges like `0..128` in `match` statements

//  Declare the libraries that contain macros
extern crate cortex_m;
//  Declare the external library `cortex_m`
extern crate lvgl;
//  Declare the LittlevGL (LVGL) library
extern crate macros as mynewt_macros;
//  Declare the Mynewt Procedural Macros library

//  Declare the modules in our application
mod screen_time {
    //  Declare `screen_time.rs` as Rust module `screen_time` for Watch Face

    //  Declare the system modules
    //  Import `PanicInfo` type which is used by `panic()` below
    //  Import cortex_m assembly function to inject breakpoint
    //  Import Semihosting Console functions

    //  Don't mangle the function name
    //  Declare extern "C" because it will be called by RIOT OS firmware

    //  Display the filename and line number to the Semihosting Console.
    //  Pause in the debugger.
    //  Display the payload.
    //  Loop forever so that device won't restart.
    //! Watch Face in Rust
    use core::ptr;
    use lvgl::{result::*, core::{obj}, objx::{label}, fill_zero};
    /// Style for the Time Label
    static mut style_time: obj::lv_style_t =
        unsafe {
            ::core::mem::transmute::<[u8; ::core::mem::size_of::<obj::lv_style_t>()],
                                     obj::lv_style_t>([0;
                                                          ::core::mem::size_of::<obj::lv_style_t>()])
        };
    /// Create the Time Screen, populated with widgets
    #[no_mangle]
    extern "C" fn screen_time_create(ht: *const home_time_widget_t)
     -> LvglResult<*mut obj::lv_obj_t> {
        let scr = obj::create(ptr::null_mut(), ptr::null())?;
        let label1 = label::create(scr, ptr::null())?;
        label::set_long_mode(label1, label::LV_LABEL_LONG_BREAK);
        label::set_text(label1, "00:00");
        obj::set_width(label1, 240);
        obj::set_height(label1, 200);
        label::set_align(label1, label::LV_LABEL_ALIGN_CENTER);
        obj::align(label1, scr, obj::LV_ALIGN_CENTER, 0, -30);
        label::set_style(label1, label::LV_LABEL_STYLE_MAIN, &style_time);
        ht.lv_time = label1;
        let l_state = label::create(scr, ptr::null())?;
        obj::set_width(l_state, 50);
        obj::set_height(l_state, 80);
        label::set_text(l_state, "");
        label::set_recolor(l_state, true);
        label::set_align(l_state, label::LV_LABEL_ALIGN_LEFT);
        obj::align(l_state, scr, obj::LV_ALIGN_IN_TOP_LEFT, 0, 0);
        ht.lv_ble = l_state;
        let l_power = label::create(scr, ptr::null())?;
        obj::set_width(l_power, 80);
        obj::set_height(l_power, 20);
        label::set_text(l_power, "");
        label::set_recolor(l_power, true);
        label::set_align(l_power, label::LV_LABEL_ALIGN_RIGHT);
        obj::align(l_power, scr, obj::LV_ALIGN_IN_TOP_RIGHT, 0, 0);
        ht.lv_power = l_power;
        let label_date = label::create(scr, ptr::null())?;
        label::set_long_mode(label_date, label::LV_LABEL_LONG_BREAK);
        obj::set_width(label_date, 200);
        obj::set_height(label_date, 200);
        label::set_align(label_date, label::LV_LABEL_ALIGN_CENTER);
        obj::align(label_date, scr, obj::LV_ALIGN_CENTER, 0, 40);
        ht.lv_date = label_date;
        obj::set_click(scr, true);
        obj::set_event_cb(scr, _screen_time_pressed);
        obj::set_event_cb(label1, _screen_time_pressed);
        _screen_time_update_screen(&ht.widget);
        Ok(scr)
    }
    #[repr(C)]
    struct home_time_widget_t {
        widget: widget_t,
        handler: control_event_handler_t,
        screen: *const obj::lv_obj_t,
        lv_time: *const obj::lv_obj_t,
        lv_date: *const obj::lv_obj_t,
        lv_ble: *const obj::lv_obj_t,
        lv_power: *const obj::lv_obj_t,
        ble_state: bleman_ble_state_t,
        time: controller_time_spec_t,
        millivolts: u32,
        charging: bool,
        powered: bool,
    }
    struct widget_t {
    }
    struct control_event_handler_t {
    }
    struct controller_time_spec_t {
    }
}
use core::panic::PanicInfo;
use cortex_m::asm::bkpt;
use lvgl::console;
///  Main program that initialises the sensor, network driver and starts reading and sending sensor data in the background.
///  Will be called at startup.
#[no_mangle]
extern "C" fn rust_main() { }
///  This function is called on panic, like an assertion failure. We display the filename and line number and pause in the debugger. From https://os.phil-opp.com/freestanding-rust-binary/
#[panic_handler]
fn panic(info: &PanicInfo) -> ! {
    console::print("panic ");
    if let Some(location) = info.location() {
        let file = location.file();
        let line = location.line();
        console::print("at ");
        console::buffer(&file);
        console::print(" line ");
        console::printint(line as i32);
        console::print("\n");
        console::flush();
    } else { console::print("no loc\n"); console::flush(); }
    bkpt();
    console::print(info.payload().downcast_ref::<&str>().unwrap());
    console::print("\n");
    console::flush();
    loop  { }
}
